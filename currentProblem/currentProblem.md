# –ü—Ä–æ–±–ª–µ–º–∞ —Å torchaudio –≤ WAN 2.2 ServerLess Worker

## üî¥ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –°–∏–º–ø—Ç–æ–º—ã –∏–∑ –ª–æ–≥–æ–≤

```
AttributeError: partially initialized module 'torchaudio' has no attribute 'lib' (most likely due to a circular import)
```

### Root Cause Analysis

1. **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç torchaudio** –≤ `/comfyui/comfy_api/latest/_ui.py:12`
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ç—á–∏–Ω–≥–∞** - –ø–∞—Ç—á–∏ –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å –ü–û–°–õ–ï –∑–∞–ø—É—Å–∫–∞ ComfyUI
3. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø–∞—Ç—á–∏**:
    - `sitecustomize.py`
    - `torchaudio_patch.py`
    - Subprocess –æ–±–µ—Ä—Ç–∫–∏

## üîß –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Dockerfile

```dockerfile
# –†–ê–ù–ù–ò–ô –ü–ê–¢–ß torchaudio - –î–û –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ComfyUI
COPY torchaudio_patch.py /tmp/torchaudio_patch.py
RUN python3 /tmp/torchaudio_patch.py

# –ö–ª–æ–Ω–∏—Ä—É–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ComfyUI
WORKDIR /
RUN git clone https://github.com/comfyanonymous/ComfyUI.git /comfyui
```

### –£–ø—Ä–æ—â–µ–Ω–∏–µ startup.sh

**–ë—ã–ª–æ** (80+ —Å—Ç—Ä–æ–∫ —Å–ª–æ–∂–Ω–æ–≥–æ –∫–æ–¥–∞):

-   sitecustomize.py —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–∞—Ç—á–∞–º–∏
-   subprocess –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è ComfyUI
-   –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—á–µ–π

**–°—Ç–∞–ª–æ** (–ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫):

```bash
# torchaudio –ø–∞—Ç—á —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω –≤ Dockerfile
echo "‚úÖ torchaudio –ø–∞—Ç—á –ø—Ä–∏–º–µ–Ω–µ–Ω –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏"

# –ó–∞–ø—É—Å–∫–∞–µ–º ComfyUI
echo "üé® –ó–∞–ø—É—Å–∫ ComfyUI..."
cd /comfyui
python main.py --listen 0.0.0.0 --port 8188 &
COMFY_PID=$!
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

-   **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –£–±—Ä–∞–ª–∏ 80+ —Å—Ç—Ä–æ–∫ —Å–ª–æ–∂–Ω–æ–≥–æ –∫–æ–¥–∞
-   **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ü–∞—Ç—á –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ä–∞–Ω–æ, –¥–æ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤
-   **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ –±–µ–∑ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã—Ö –æ–±–µ—Ä—Ç–æ–∫
-   **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: torchaudio mock —Å–æ–∑–¥–∞–µ—Ç—Å—è –ü–ï–†–ï–î –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º ComfyUI

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

-   –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ torchaudio
-   –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ ComfyUI –±–µ–∑ –ø–∞–¥–µ–Ω–∏–π
-   –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ GitPython –∏ ComfyUI-Manager

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö workflow —Ç–∏–ø–æ–≤ (T2I, T2V, I2I, Video Upscale)

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–∞–ª—å

–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –ø—Ä–∏–º–µ–Ω–∏—Ç—å mock torchaudio –º–æ–¥—É–ª–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–º —É—Ä–æ–≤–Ω–µ –î–û —Ç–æ–≥–æ, –∫–∞–∫ Python –≤—Å—Ç—Ä–µ—Ç–∏—Ç –ª—é–±—ã–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã torchaudio –≤ –∫–æ–¥–µ ComfyUI. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É.
