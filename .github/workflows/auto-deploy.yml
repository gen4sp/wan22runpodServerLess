name: Auto Deploy

on:
    push:
        branches: [main, master]
    pull_request:
        branches: [main, master]

jobs:
    auto-deploy:
        runs-on: ubuntu-latest
        # –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—É—à–µ–π –≤ main/master, –Ω–µ –¥–ª—è PR
        if: github.event_name == 'push'

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Set up Python
              uses: actions/setup-python@v4
              with:
                  python-version: "3.10"

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install -r requirements.txt

            - name: Get current version
              id: version
              run: |
                  VERSION=$(python -c "from version import get_version; print(get_version())")
                  echo "version=$VERSION" >> $GITHUB_OUTPUT
                  echo "Current version: $VERSION"

            - name: Create automatic release
              uses: softprops/action-gh-release@v1
              with:
                  tag_name: "v${{ steps.version.outputs.version }}-auto-${{ github.run_number }}"
                  name: "Auto Deploy v${{ steps.version.outputs.version }}-${{ github.run_number }}"
                  body: |
                      üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ –ø—É—à–∞ –≤ ${{ github.ref_name }}

                      **–î–µ—Ç–∞–ª–∏:**
                      - –ö–æ–º–º–∏—Ç: ${{ github.sha }}
                      - –ê–≤—Ç–æ—Ä: ${{ github.actor }}
                      - –í—Ä–µ–º—è: ${{ github.event.head_commit.timestamp }}

                      –ò–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã –≤ RunPod —á–µ—Ä–µ–∑ GitHub –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.
                  draft: false
                  prerelease: false
                  generate_release_notes: true
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
